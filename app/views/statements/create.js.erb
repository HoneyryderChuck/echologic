<% if defined? @info %>
  info('<%=@info%>') 
<% end %>

/* if we came directly from one of the new statement links in search or my questions, then html response */
if(!window.location.href.match(/\/\d+/)) {
  window.location.replace("<%= statement_node_url(@statement_node, :origin => params[:origin], :search_terms => params[:search_terms], :bids => params[:bids]) %>");
}

/* load new statement to session */
<% if @statement_node.parent %>
  var session_id = '<%= dom_class(@statement_node.parent) %>';
<% else %>
  var session_id = 'roots';
<% end %>
  var session_data =  $('div#statements').data(session_id);
	if (session_data != null) {
		session_data.unshift(<%= @statement_node.id %>);
		$('div#statements').data(session_id, session_data);
	} else {
	  session_data = [<%= @statement_node.id %>, "add/<%= dom_class(@statement_node) %>"]
	}
	
var element = $("<%= escape_javascript(render :partial => 'statements/show') %>");
element.statement('insert',<%= @statement_node.level %>).statement('removeBelow');

/* Statements' stack */	
var sids = $('div#statements .statement').map(function(){
  return this.id.replace(/[^0-9]+/, "");
}).get();


var bids = $('#breadcrumbs').breadcrumb('getBreadcrumbStack', null);

$.setFragment({ "bids" : bids.join(','), "sids": sids.join(','), "new_level" : ''});