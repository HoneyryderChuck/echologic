<% if defined? @info %>
  info('<%=@info%>');
<% end %>
<% if defined? @error %>
  info('<%=@error%>');
<% end %>

/* history handling */
<% if @node_environment.sids? and @ancestors %>
  <% inc = @node_environment.level - @ancestors.length %>
  var stack = <%= @node_environment.sids.to_json %>;
  <% @ancestors.keys.length.times do |index| %>
    var ancestor = stack[<%= index %>];
    var ancestor_element = $('#statements .statement').eq(<%= index %>);
    /* if not rendered, than render */
    if(ancestor_element.length == 0 || !ancestor_element.attr('id').match(ancestor)) {
      var new_ancestor = $("<%= escape_javascript(render_ancestor(@ancestors[index], @ancestors.get_document(@ancestors[index]))) %>").statement({'level': <%= inc + index %>});
    } else {
      ancestor_element.data('api').hide();
    }
  <% end %>
<% end %>


/* breadcrumb */
$('#breadcrumbs').data('breadcrumbApi').deleteBreadcrumbs();
<% if @breadcrumbs %>
  $('#breadcrumbs').data('breadcrumbApi').addBreadcrumbs(<%= @breadcrumbs.map(&:to_hash).to_json %>);
<% else %>
  $('#breadcrumbs').data('breadcrumbApi').hideContainer();
<% end %>

var add_teaser = $("<%= escape_javascript(render :partial => 'statements/add',
                                                 :locals => {:hide_content => true}) %>").statement({'level' : <%= @node_environment.level %>});
