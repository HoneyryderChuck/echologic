/* Stack handling */
<% if @node_environment.sids? and @ancestors %>
  <% inc = @node_environment.level - @ancestors.length %>
  <% stack = @node_environment.sids %>
	<% @ancestors.keys.length.times do |index| %>
		var ancestor_element = $('#statements > .statement').eq(<%= index %>);
		/* If not rendered, then render now */
		if(ancestor_element.length == 0 || !ancestor_element.attr('id').match(<%= stack[index] %>)) {
		  var new_ancestor = $("<%= escape_javascript(render :partial => 'statements/show', 
	          												 :locals => {:statement_node => @ancestors[index], 
	          												 			 :statement_document => @ancestors.get_document(@ancestors[index]), 
	          												 			 :only_header => true}) %>");
		  new_ancestor.statement({'level' : <%= inc + index %>});
	    } else {
	      ancestor_element.data('statement').hide();
	    }
  <% end %>
<% end %>





var element = $("<%= escape_javascript(render :partial => 'statements/show',
                                              :locals => {:hide_content => true}) %>").statement({'level'   : <%= @node_environment.level %>,
									         													  'message' : "<%= @info || @error %>",
									         													  'expand'	: <%= params[:expand].present? %>});

// Breadcrumbs
$('#breadcrumbs').data('breadcrumbApi').deleteBreadcrumbs();
<% if @breadcrumbs %>
  $('#breadcrumbs').data('breadcrumbApi').addBreadcrumbs(<%= @breadcrumbs.map(&:to_hash).to_json %>);
<% else %>
  $('#breadcrumbs').data('breadcrumbApi').hideContainer();
<% end %>
